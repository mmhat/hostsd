#!/usr/bin/bash

set -eu

cat > /etc/hosts <<EOF
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by hosts-gen using templates
# from /etc/hosts.d
#

EOF

for f in $(ls /etc/hosts.d); do
    path="/etc/hosts.d/${f}"
    echo "### BEGIN ${f} ###" >> /etc/hosts
    grep -Ev '^\s*(#.*)?$' ${path} >> /etc/hosts || true
    echo -e "### END ${f} ###\n" >> /etc/hosts
done 
